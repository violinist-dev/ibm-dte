sudo: false
dist: trusty
services:
- docker
before_install:
- sudo apt-get -y update || true
- sudo apt-get -y install cgroup-bin curl
- curl -fsSL -o /tmp/lando-latest.deb https://github.com/lando/lando/releases/download/v3.0.0-rc.1/lando-v3.0.0-rc.1.deb
- sudo dpkg -i /tmp/lando-latest.deb
- lando version
- lando start -- -v
- composer global require pantheon-systems/terminus:^1.9.0
install:
- lando composer install
script:
- lando composer prepare-for-pantheon
- lando terminus auth:login --machine-token=$PANTHEON_TOKEN
- lando pull --code=none --database=dev --files=dev --rsync
- lando terminus backup:get ibm-dte.dev --element=db --to=/app/database.sql.gz
- lando db-import database.sql.gz
- cd web
- lando drush cr | grep "rebuild complete."
- cd ..
before_deploy:
- git remote add pantheon $PANTHEON_GIT
deploy:
- provider: script
  skip_cleanup: true
  script: scripts/travis/deploy.sh
  on:
    branch: master
after_script:
- lando terminus ssh-key:remove $(ssh-keygen -l -f ~/.lando/keys/pantheon.lando.id_rsa.pub
  | awk -F' ' '{print $2}' | sed 's/://g')
env:
  global:
  - secure: HNe2s9VhRvraI2mVSEQM+BXjPzRodl99mn1mQQIHFwikyedMz5+M61Uynr99o7WOwfHGDs1V/Z7kzxS7d58IjpHf3hTZ78fY2J1aKIUJVo3JGr3iz4Zgv/pPzYW7hDcStSyN1KpRIPsazf/8qg5i8v2FXe21yF6BP7KNP6H3YtW3xYV4kLtzFSz5JWwcmwW18SDVOsG/0l5hozbplMVLiDIc4rxmArsTI6BKl4s3TndsfjZpTz8YBZ5z/aZTBBVI4mN+wud4ZwHuV5230BMz4erMZUbgSpIxWXV1O/yT5L5ejNXHWgZyhFBwpkGPpeArZlDonn7V/VP9lwErYsRbLrd666RVeve93R5DzVsCi17bdM7GVrjWuE4CNhhviCx5omR+1Cokn0c2sL5cULDfc5OkPNN6jp3VLSuhsSGJobTFwRa7NkUVChSBKeInYomrkGK3wufq7Aycz2pL1JANVgy0RWa4rtRai847zH2gjRzqrampy+iic5N4oQdHlzqHC7nTxTKko1d4ssvLQd9LjrZSPc1d0/+Im2l1oeuRn9hNedtYNbiMDGhf5TUTiiEabxR+7dP/8psgOR33ZMHdFfBWAGX8jLE78FKojgSF95dSmvXpWH68u9WKIBHvrGc3hMsPSz3IdvYP8m9nD+wnRYtLvRJN2L3H/barhnSqeRI=
notifications:
  email: false
  slack:
    secure: sMddqvtYmjXfiKGxPa/jnvbaBkIXozaKQGF6p37S9n/z9CMF4SAaKmRqWXssvUloP/5BKAnrlRMLs3zvnZOeScn716k4TU5wMS7dGSdZdDUejCVoh2ggCBTMKrWm1J6bjVhSS+E+1AE9IO9VetUH3veTFwgi/bDDpL1Iqde1lAmYhkAjcD755r1IMBTwk530cxjcEoUtUQRcZ2UivCFtT5h8i0JpJyTOxJUS/B6YbEel58TcqRO9xUWspI8LCG78LwmtrBuxD34VjKOzUoESgwOJUv3N6XxuUZEaPybN6qfVnT9X1OoMFisBmivrIb9WKDQfJotuWnuO7wX7aZ9vlUsFF7S4eRMkRPZrCmyvPTKZtzavKwpbotCjy8OkjuAitYeJkGQqmG4BOKHktVfLtQxtQUAbQMnylqki/HO3BTjAWQw6VUJhLMBmCrMVrzXfdlH/X7lj0G1qx3yqX1jG0QdbBnxh1d4CDZPrdyFq9MI9fylJUow9JOxSMs46QXUoTyOTxS/ujTJ4yruI0EhtGlXHo3Syh9IFWUdJYVW+UNvYdMQifhuQPCmfJvxGEUh871aOGnm1YfB1eZVJRiw/ERLRri3x4cAfEj3/W+64CTVL6SAczz5P8grIw+WA92KhWRIrn2mtPQ1SJ7NSg5e+KlCtLrOVLAyXcvWspDa6SUU=
