sudo: false
dist: trusty
services:
- docker
before_install:
- sudo apt-get -y update || true
- sudo apt-get -y install cgroup-bin curl
- curl -fsSL -o /tmp/lando-latest.deb https://github.com/lando/lando/releases/download/v3.0.0-rc.1/lando-v3.0.0-rc.1.deb
- sudo dpkg -i /tmp/lando-latest.deb
- lando version
- lando start -- -v
- composer global require pantheon-systems/terminus:^1.9.0
install:
- lando composer install
script:
- lando composer prepare-for-pantheon
- lando terminus auth:login --machine-token=$PANTHEON_TOKEN
- lando pull --code=none --database=dev --files=dev --rsync
- lando terminus backup:get ibm-dte.dev --element=db --to=/app/database.sql.gz
- lando db-import database.sql.gz
- cd web
- lando drush cr | grep "rebuild complete."
- cd ..
before_deploy:
- git remote add pantheon $PANTHEON_GIT
deploy:
- provider: script
  skip_cleanup: true
  script: scripts/travis/deploy.sh
  on:
    branch: master
after_script:
- lando terminus ssh-key:remove $(ssh-keygen -l -f ~/.lando/keys/pantheon.lando.id_rsa.pub | awk -F' ' '{print $2}' | sed 's/://g')
env:
  global:
  - secure: yR9tScYLwBITWGlXVDjeY8/JTVxlnMRn5rYnHBsMLiIbXzs5GUR/nfkvPIzyNbG1tFYaS7bHGidnI6bvPeqVTjl2rII9yOWmio6604uachFnUCkxBb++fRfA/GXYE+Wk9D6pkMn6GmOA92aldaxsAsyYb9KQtwk4PIJwetLOSKVmLN64oytrj9rfVFX7cIEB2jvcwYf94gVgw/UTlOIRLRAEZfuBlH2TmJjBwf51lO2PiHEL9TCQoryk1EifxZjg1LynZ7TFajMh7c9MH5SVMRrIXRwijrDj7P0ZELn0PS5NYHSGdtKlmeAho4KO7zizRJ++lWKT2LbPf2V8QD+yFW/OYp3oXHgnPgIh9oc4HGsy2Qsd+8Ry9eY9t115eNAn95kEl1dDBH67QSbFL1SDjEJ6rFOKzBfHY1aeav03PHno0Ui9WDO3IDXZMnm5jqY0indQUIrXGRSHnyUFMTxswfM95Rgsn9aa6M5Z+YDYs45Iiblco18KD0CA4H4yz21jBz6JFwr2Ft/1NixSCz8tfJ8m1f1nfO3JtT29qIA0xWLS7+RvS+d/hkkeNCO2dDvYku+k//jHE1YWIdZE3g3FF6IIJmdcEBNfcUpRPTK22KIM+gcElpS1DI1Lf0IhqIW2nZs3HCLT+e+6fvSR/oM0en70GYGKbKtMTxBX5hJGw2Y=
  - secure: 2W10tWPhPVsECYzsAz1DEsUTERftonemP4r3pilAGYytAJ5hRYXo/9yckE3Iqoyk+pV5M2Ib66gnP0kZLB4juZVkhOgKsceDLorgkQ20gIVdXObOCxe57IPuHx6T5D01qOZ02QoANozqeICHXbdjmAYYmqpoFcW5cGZB/Uh0XGHu/jrNUK3drZHPVpuPcW6xm8cIV9YC6Xtcmguov7LUTvHtf9VOSiWD022RDP653Nv30elKb3ET2n66Ee4GtHMIGn+mt/5i+eOwZ4mfaB6zFz4cPM36blT13TNSfPKyNSmXUBg8K5ClS+QIAzdW40yothO8HkWfjGR3SMMu6X0D987PrGi5lswM7xJGbhIf81Z5edVLQ6XdKsEp1c98O4IYvPLeq49cIxU8EpuA/6If5ufe5GwYnBV8tBcyxNYOduKaAo6yRogb8sJlritbEcbzIPTPVPFJOgfye/DFpmeEekHqLNreSr84wbfZecuhSJ3/7Yoq/jhKUJ/6TpcR8fI4kRd4V5MVJuqym53qmvcWKjy4oFeCjFL/kB2DsHSjb66h8BMp8ClQ7W5mRB9CIBaMdRYa56tJhKw5GWdGySO8gi/tVPLJx+BO88fzijX7eWYhQwMicGvMyxlawfrpjfGK/b4/dP4tOFsIjAwFIi3QUp1lBrrlBQzZ2y+mz9NAq3Y=
  - secure: 01vwLsHh9jRPWaJeYeh32olqKmpMLQZTAsxggv98l7zgUuwL2tM28fPZAHCjwSzIFRzhISMrf8FbG2XnqEA8NBKA16aK+OjiNI+Tk9ryClxC/c8ZDaZyfvoxcRk8maqUCV2wUd8W19s2vtK4VBNWq31wjsHnetu5iDo/5UsJR468Vo3aUx5bU/9FXFsizJ7CsOSSzPZuiTzrzFt/s2HjL7tyHaZt+JlnZfTrHuNseg/+fuK8BNS56emAYtUAesdvJBmU4jztAFxiD2FFyDDVbHWKHsRyJLGjwP3iMCzE4ESPX0kuaoG6wP1tPow9KhMjmyQB/Igvuw2Gy/2XlINhFBW3dgIvEsYtR1kA5JFUQnA79jS3jniD0HMmnq16pMtDRNYE1gtIjtclgSfJp4nFghsNHOZVgCnfEENS1Cp9dX1h2BVQKOrpSJ84SQVJhc52encCWh+vD20rqbk78Ay3EWsnHFfLM4WUmpNk4jpJz854omZoFgGy4jrwYfRjedMB3RKwrGA1NuPX2StC04k8BlosbZ98YzW/zNsL/0m9ghy2OuVycyF8xyAHxlms/S9XeWKlBud6rqZx6kCDaTwSa9+xBYfMV0hq8It9yxsBWuqP1dBEEABdfojZx3+fsrrcYz7uMHKm61NA7l1YIvJTXC81+/HLJ5GTrwGadxaMS0Q=
  - secure: NnmvtXH9nMFMSXJmjRtvVa5R4s33VjNWCOXQ6Q4+ZlnCj6YLozjXgcJpg3SKEZ80yITzEMLTOwAWlgfh4RVtVixhjVk7xEKLbiajVnCd+8/IIesVpU0snAxu5X2PeXGavIEBgWZqJzvfwo99mmVo2N9YIaU6rQBh1tNcHAPw8v2vOdwuGIUYDiZpCSqNpLudkydBgt5nD4yhuu+857wmNXSnEYtLvD6TzjA4CH7xe3i4ytZ1ktrFRx9HAvk7FN2hHHy8iMgnzHOYCFfYZcbnb8X6Q8MhHQkUGzCOyvTMEmgKTQqkkcJlHsRbWublQdURze+M35EC2fo04xH20XDOw1Vy7zgjtY0v0rMv/EoW1YZ9ciVg3zCec0pBlwtRVhB8aBlBop8YTfrX0KuZPLzK+jzJTRkyzYmxh/8qvTvMufxTLZjkPaDhRM/3cjB3RqRMmW165h7C9BEp/AW7ZURWCtI54JRbky5BgNaWJdH2a8KV/htaYzFKa6m83m6mRF7MpIQ8G+THC6jCqR1jXgpkCszSyZibGPGAPRZWxi3az7HLmtXesrPM5gF/ofiGhw3c9mfpvLJbqUXjdVSvu3elHnUdEoIj+isG5JXZ3vpFH4U++oPt9iKe07x7/g7VNmJc6Ccm+553OmlNnGNiXNJ8ScpVFQd3md7Fcrwe6/spIsE=
notifications:
  email: false
  slack:
    secure: sMddqvtYmjXfiKGxPa/jnvbaBkIXozaKQGF6p37S9n/z9CMF4SAaKmRqWXssvUloP/5BKAnrlRMLs3zvnZOeScn716k4TU5wMS7dGSdZdDUejCVoh2ggCBTMKrWm1J6bjVhSS+E+1AE9IO9VetUH3veTFwgi/bDDpL1Iqde1lAmYhkAjcD755r1IMBTwk530cxjcEoUtUQRcZ2UivCFtT5h8i0JpJyTOxJUS/B6YbEel58TcqRO9xUWspI8LCG78LwmtrBuxD34VjKOzUoESgwOJUv3N6XxuUZEaPybN6qfVnT9X1OoMFisBmivrIb9WKDQfJotuWnuO7wX7aZ9vlUsFF7S4eRMkRPZrCmyvPTKZtzavKwpbotCjy8OkjuAitYeJkGQqmG4BOKHktVfLtQxtQUAbQMnylqki/HO3BTjAWQw6VUJhLMBmCrMVrzXfdlH/X7lj0G1qx3yqX1jG0QdbBnxh1d4CDZPrdyFq9MI9fylJUow9JOxSMs46QXUoTyOTxS/ujTJ4yruI0EhtGlXHo3Syh9IFWUdJYVW+UNvYdMQifhuQPCmfJvxGEUh871aOGnm1YfB1eZVJRiw/ERLRri3x4cAfEj3/W+64CTVL6SAczz5P8grIw+WA92KhWRIrn2mtPQ1SJ7NSg5e+KlCtLrOVLAyXcvWspDa6SUU=
